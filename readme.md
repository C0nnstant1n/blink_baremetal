# Модуль управления светодиодом и кнопкой (`app`)

## Краткое описание

Учебно исследовательский проект, написанный спомощью Алиса AI (В основном для написания документации).
Встроенное приложение для микроконтроллера, реализующее **конечный автомат** для управления светодиодом по нажатиям кнопки с использованием периодического таймера пробуждения (`sl_sleeptimer`).

Написан с использованием
Simplicity SDK Suite v2024.12.1

## Функциональность

Модуль обеспечивает:

- периодическое пробуждение системы через таймер;
- обработку **коротких** и **длинных** нажатий кнопки;
- три режима работы светодиода:
  - **выключен** (`APP_STATUS_LED_OFF`);
  - **постоянно включён** (`APP_STATUS_LED_ON`);
  - **мигающий** (`APP_STATUS_BLINK`);
- подсчёт количества срабатываний таймера (`timer_count`).

## Ключевые переменные (с выделением)

В модуле используются следующие **локальные статические переменные** (недоступны извне):

- `` `timer` `` — дескриптор периодического таймера (тип: `sl_sleeptimer_timer_handle_t`).
- `` `timer_count` `` — счётчик срабатываний таймера (тип: `uint8_t`, диапазон: 0–255).

**Состояние конечного автомата** хранится в локальной статической переменной:

- `` `app_status` `` (тип: `uint8_t`) — принимает значения `APP_STATUS_LED_OFF`, `APP_STATUS_LED_ON` или `APP_STATUS_BLINK`.

**Статус кнопки** читается в локальной переменной:

- `` `button_status` `` (тип: `uint8_t`) — значение, возвращаемое `get_button_status()`.

## Архитектура

- **Конечный автомат** с тремя состояниями, переключаемыми по событиям кнопки.
- **Таймер** для периодического пробуждения (интервал задаётся через макрос `TOOGLE_DELAY_MS`).
- **Обработчик таймера** `on_timeout` увеличивает `` `timer_count` `` на 1 при каждом срабатывании.
- Все внутренние переменные объявлены как `static` — скрыты от других модулей.

## Зависимости

- `sl_sleeptimer.h` — системный таймер Silicon Labs;
- `button.h` — модуль обработки кнопок (`get_button_status`, `button_handle`);
- `blink.h` — модуль мигания светодиода (`blink_process_action`);
- `sl_led.h` — управление светодиодами (`sl_led_turn_on`, `sl_led_turn_off`).

## Публичный API

1. **`void app_init(void)`**  
   Инициализирует периодический таймер для пробуждения системы.

2. **`void app_process_action(void)`**  
   Основной цикл: вызывает обработку кнопки и логику приложения.

3. **`uint8_t get_timer_count(void)`**  
   Возвращает текущее значение счётчика срабатываний таймера (`` `timer_count` ``).

4. **`void app_handle(void)`**  
   Реализует логику конечного автомата по управлению светодиодом.

## Конфигурационные параметры

- **`TOOGLE_DELAY_MS`** — период срабатывания таймера в миллисекундах (по умолчанию может быть определён как `1000` — 1 сек).

## Состояния конечного автомата

| Состояние            | Описание           | Переход при `BUTTON_SHORT_CLIK` | Переход при `BUTTON_LONG_CLIK` |
| -------------------- | ------------------ | ------------------------------- | ------------------------------ |
| `APP_STATUS_LED_OFF` | Светодиод выключен | → `APP_STATUS_LED_ON`           | → `APP_STATUS_BLINK`           |
| `APP_STATUS_LED_ON`  | Светодиод включён  | → `APP_STATUS_LED_OFF`          | → `APP_STATUS_BLINK`           |
| `APP_STATUS_BLINK`   | Светодиод мигает   | → `APP_STATUS_LED_OFF`          | → `APP_STATUS_LED_ON`          |

## Использование

1. Определите `TOOGLE_DELAY_MS` в проекте (например, в `config.h`).
2. Вызовите `app_init()` при старте системы.
3. В основном цикле регулярно вызывайте `app_process_action()`.

**Пример `main.c`:**

```c
#include "app.h"

int main(void) {
    app_init();
    while (1) {
        app_process_action();
        // Другие задачи...
    }
}
```

## Примечания

- Переменные `` `timer` `` и `` `timer_count` `` объявлены как `static` — недоступны извне модуля.
- Обработчик `on_timeout` подавляет предупреждения компилятора о неиспользуемых параметрах (`handle`, `data`).
- Для работы требуются реализации из зависимых модулей (`button.h`, `blink.h` и др.).
- Макросы состояний (`APP_STATUS_...`) и типов нажатий (`BUTTON_SHORT_CLIK`, `BUTTON_LONG_CLIK`) должны быть определены в подключаемых заголовочных файлах.

## Лицензия

[GPL]

## Автор

[С0nstant1n]  
[https://github.com/C0nnstant1n/blink_baremetal.git]

## Requirements

Silicon Labs board with on-board LED.
